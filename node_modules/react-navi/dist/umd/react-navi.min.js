!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("navi")):"function"==typeof define&&define.amd?define(["exports","react","navi"],t):t((e=e||self).ReactNavi={},e.React,e.Navi)}(this,function(e,t,n){"use strict";var r=t.createContext("auto");function o(e){return e.behavior?t.createElement(r.Provider,{value:e.behavior},e.children):t.createElement(t.Fragment,null,e.children)}function i(e,t,n){if("auto"===n)window.scroll(e,t);else try{window.scroll({top:t,left:e,behavior:n})}catch(n){window.scroll(e,t)}}function a(e,t){if(void 0===t&&(t="auto"),e){var n=document.getElementById(e.slice(1));if(n){var r=n.getBoundingClientRect(),o=r.top;i(r.left+window.pageXOffset,o+window.pageYOffset,t),n.focus()}}else i(0,0,t)}var u,c=t.createContext({}),s=(c.Consumer,c.Provider,u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},f=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};function h(e){return!e||"string"==typeof e&&(-1!==e.indexOf("://")||0===e.indexOf("mailto:"))}function p(e,t){if(!h(e))return t&&"string"==typeof e&&(e="/"===e[0]?e:n.joinPaths("/",t.pathname,e)),n.createURLDescriptor(e)}var d=function(e,r){var o=void 0===r?{}:r,i=o.exact,a=void 0===i||i,u=o.loading,s=void 0!==u&&u,l=t.useContext(c),f=s?l.busyRoute||l.steadyRoute:l.steadyRoute||l.busyRoute,h=f&&f.url,d=p(e,h);return!(!d||!h||(a?d.pathname!==h.pathname:0!==n.modifyTrailingSlash(h.pathname,"add").indexOf(d.pathname)))},v=function(e){var o=e.disabled,i=e.hashScrollBehavior,u=e.href,s=e.prefetch,d=e.target,v=e.onClick,y=f(e,["disabled","hashScrollBehavior","href","prefetch","target","onClick"]),m=t.useContext(r),b=t.useContext(c),g=b.navigation;void 0===i&&(i=m);var C=b.steadyRoute||b.busyRoute,w=C&&C.url,R=p(u,w);if(!h(u)){var x=u;w&&"string"==typeof u&&(x="/"===u[0]?u:n.joinPaths("/",w.pathname,u)),R=n.createURLDescriptor(x)}t.useEffect(function(){s&&g&&R&&R.pathname&&g.prefetch(R).catch(function(e){console.warn('A <Link> tried to prefetch "'+R.pathname+'", but the router was unable to fetch this path.')})},[g,s,R&&R.href]);var O=t.useCallback(function(e){if(0===e.button&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){if(o)return void e.preventDefault();if(v&&v(e),d)return;if(!w)return;if(!e.defaultPrevented&&R){e.preventDefault();var t=n.modifyTrailingSlash(R.pathname,"remove")===n.modifyTrailingSlash(w.pathname,"remove");g.navigate(R),(t||""===R.pathname)&&R.hash===w.hash&&R.hash&&a(w.hash,i)}}},[o,v,d,R&&R.href,w&&w.href]);return l({disabled:o,onClick:O,href:R?R.href:u},y)},y=t.createContext(void 0),m=function(e){function n(n){var r=e.call(this,n)||this;return r.renderChildren=function(e){var n=r.props,o=(n.fromDefaultRenderer,f(n,["fromDefaultRenderer"])),i=e.onClick;return r.props.onClick&&(i=function(t){r.props.onClick(t),t.defaultPrevented||e.onClick(t)}),t.createElement("a",l({},e,o,{onClick:i}))},r}return s(n,e),n.prototype.render=function(){return t.createElement(y.Consumer,{children:this.renderChildren})},n}(t.Component),b=Object.assign(t.forwardRef(function(e,n){var r=e.active,o=(e.activeClassName,e.activeStyle,e.children),i=e.exact,a=e.hashScrollBehavior,u=e.href,c=e.onClick,s=e.prefetch,h=e.render,p=f(e,["active","activeClassName","activeStyle","children","exact","hashScrollBehavior","href","onClick","prefetch","render"]),m=v({hashScrollBehavior:a,href:u,onClick:c,prefetch:s}),b=d(u,{exact:!!i});void 0===r&&(r=b);var g=l({children:o},p,m,{ref:n});return t.useEffect(function(){},[h]),t.createElement(y.Provider,{value:g},h({active:r,activeClassName:e.activeClassName,activeStyle:e.activeStyle,anchorProps:g,children:e.children,className:e.className,disabled:e.disabled,tabIndex:e.tabIndex,hidden:e.hidden,href:m.href,id:e.id,lang:e.lang,style:e.style,target:e.target,title:e.title,onClick:m.onClick}))}),{Anchor:m});b.defaultProps={render:function(e){var n=e.active,r=e.activeClassName,o=e.activeStyle,i=e.children,a=e.className,u=e.hidden,c=e.style;return t.createElement(m,{children:i,className:(a||"")+" "+(n&&r||""),hidden:u,style:Object.assign({},c,n?o:{}),fromDefaultRenderer:!0})}};var g=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),C=function(e){function n(t){var n=e.call(this,t)||this;return n.handleNavigationSnapshot=function(e){"busy"!==e.type?n.setState({steadyRoute:e,busyRoute:void 0}):n.setState({busyRoute:e})},n.handleError=function(e){throw e},n.state={},n}return g(n,e),n.getDerivedStateFromProps=function(e,t){if(t.navigation!==e.navigation){var n=e.navigation.getCurrentValue();return"busy"===n.type?{steadyRoute:t.steadyRoute,busyRoute:n,navigation:e.navigation}:{steadyRoute:n,busyRoute:void 0,navigation:e.navigation}}return null},n.prototype.render=function(){return t.createElement(o,{behavior:this.props.hashScrollBehavior},t.createElement(c.Provider,{value:this.state},this.props.children))},n.prototype.componentDidMount=function(){this.subscribe()},n.prototype.componentDidUpdate=function(e){e.navigation!==this.props.navigation&&(this.unsubscribe(),this.subscribe())},n.prototype.componentWillUnmount=function(){this.unsubscribe()},n.prototype.subscribe=function(){if(!this.props.navigation)throw new Error('A <NaviProvider> component must receive a "navigation" prop.');this.subscription=this.props.navigation.subscribe(this.handleNavigationSnapshot,this.handleError)},n.prototype.unsubscribe=function(){this.subscription&&(this.subscription.unsubscribe(),delete this.subscription)},n}(t.Component),w=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),R=function(){return(R=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},x=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},n}return w(t,e),t.getDerivedStateFromProps=function(e,t){return t.error&&e.context.steadyRoute.url.pathname!==t.errorPathname?{error:void 0,errorPathname:void 0,errorInfo:void 0}:null},t.prototype.componentDidCatch=function(e,t){if(!(e instanceof n.NotFoundError))throw e;this.setState({error:e,errorInfo:t,errorPathname:this.props.context.steadyRoute.url.pathname})},t.prototype.componentDidUpdate=function(e,t){this.state.error&&t.error},t.prototype.render=function(){return this.state.error?this.props.render(this.state.error):this.props.children},t}(t.Component),O=t.createContext(null),E=function(){return(E=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function P(e){return"view"===e.type}function _(e){var n=void 0===e?{}:e,o=n.disableScrolling,i=void 0!==o&&o,u=n.hashScrollBehavior,s=n.renderHead,l=n.where,f=void 0===l?P:l,h=t.useContext(r),p=t.useContext(O),d=t.useContext(c);void 0===u&&(u=h),void 0===s&&p&&(s=p);var v=d.steadyRoute||d.busyRoute;if(!v)throw new Error("react-navi: A <View> component cannot be rendered outside of a <Router> or <NaviProvider> component.");var y=d.unconsumedSteadyRouteChunks||v.chunks,m=y.findIndex(f),b=-1!==m&&y[m].view,g=-1===m||!y.slice(m+1).find(f)&&"error"!==v.type,C=t.useMemo(function(){return g?y:y.slice(0,m+1)},[g,y,m]),w=C.find(function(e){return"error"===e.type});if(w)throw w.error||new Error("Unknown routing error");if(!b&&!d.steadyRoute)throw d.navigation.getRoute();var R=t.useMemo(function(){return E({},d,{unconsumedSteadyRouteChunks:g?[]:y.slice(m+1)})},[d,y,m]),x=t.useCallback(function(e){return t.createElement(c.Provider,{value:R},t.isValidElement(e)?t.cloneElement(e):e)},[R]),_=t.useMemo(function(){return"function"==typeof b?t.createElement(b,{route:d.steadyRoute}):b||null},[b,d.steadyRoute]),S=t.useMemo(function(){return s?s(C):null},[s,C]),k=t.useRef();t.useEffect(function(){var e=v,t=k.current;if(k.current=v,g&&v&&0!==y.length&&e&&"busy"!==e.type){if(t&&e.url.pathname===t.url.pathname&&e.url.search===t.url.search&&e.url.hash===t.url.hash)return;i||t&&t.url&&t.url.hash===e.url.hash&&t.url.pathname===e.url.pathname||a(e.url.hash,t&&t.url&&t.url.pathname===e.url.pathname?u:"auto")}},[v]);var j=t.useMemo(function(){return{chunks:C,connect:x,content:_,element:x(t.createElement(t.Fragment,null,S,_)),final:g,head:S}},[C,x,_,g,S]);return 0===y.length?null:j}var S=function(e){var n=e.children,r=e.disableScrolling,o=e.hashScrollBehavior,i=e.renderHead,a=e.where,u=t.useContext(c),s=_({disableScrolling:r,hashScrollBehavior:o,renderHead:i,where:a});if(t.useEffect(function(){},[n]),!s)throw new Error("A Navi <View> was not able to find a view to render.");if(n){var l=u.steadyRoute||u.busyRoute;if("function"!=typeof n)throw new Error('A Navi <View> expects any children to be a function, but instead received "'+n+'".');return s.connect(t.createElement(t.Fragment,null,s.head,n(s.content,l)))}return s.element},k=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),j=function(e){function r(t){var r=e.call(this,t)||this;return r.navigation=t.navigation||n.createBrowserNavigation({basename:t.basename,context:t.context,history:t.history,routes:t.routes}),r}return k(r,e),r.prototype.render=function(){var e=this.props,n=e.children,r=e.hashScrollBehavior;return t.createElement(C,{navigation:this.navigation,hashScrollBehavior:r},n||t.createElement(S,null))},r.prototype.componentDidMount=function(){this.props.navigation&&this.props.context&&this.props.navigation.setContext(this.props.context)},r.prototype.componentDidUpdate=function(e){(function(e,t){for(var n in e)if(!(n in t))return!0;for(var n in t)if(e[n]!==t[n])return!0;return!1})(e.context||{},this.props.context||{})&&this.navigation.setContext(this.props.context||{})},r.prototype.componentWillUnmount=function(){this.props.navigation||this.navigation.dispose(),delete this.navigation},r.defaultProps={fallback:void 0},r}(t.Component);e.HashScroll=o,e.useLinkProps=v,e.useActive=d,e.Link=b,e.NaviProvider=C,e.NotFoundBoundary=function(e){return t.createElement(c.Consumer,null,function(n){return t.createElement(x,R({context:n},e))})},e.Router=j,e.useNavigation=function(){return t.useContext(c).navigation},e.NaviConsumer=function(e){var n=e.children;return t.useEffect(function(){},[]),t.createElement(c.Consumer,{children:function(e){var t=e.navigation;return n(t)}})},e.useHistory=function(){return t.useContext(c).navigation._history},e.History=function(e){return t.useEffect(function(){},[]),t.createElement(c.Consumer,null,function(t){return e.children(t.navigation._history)})},e.useLoadingRoute=function(){return t.useContext(c).busyRoute},e.LoadingRoute=function(e){return t.useEffect(function(){},[]),t.createElement(c.Consumer,null,function(t){return e.children(t.busyRoute)})},e.useCurrentRoute=function(){var e=t.useContext(c),n=e.steadyRoute,r=e.busyRoute;return n||r},e.CurrentRoute=function(e){return t.useEffect(function(){},[]),t.createElement(c.Consumer,null,function(t){return e.children(t.steadyRoute||t.busyRoute)})},e.View=S,e.useView=_,e.useViewElement=function(e){void 0===e&&(e={});var t=_(e);return t&&t.element},e.ViewHeadRendererContext=O,Object.defineProperty(e,"__esModule",{value:!0})});
